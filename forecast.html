<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Imports 360 - Forecasts</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    .toast-notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 1001;
        display: flex;
        align-items: center;
        gap: 12px;
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .toast-notification.show {
        opacity: 1;
        transform: translateY(0);
    }

    .toast-notification .icon {
        font-size: 24px;
    }
    .toast-notification.success {
        background-color: #28a745;
    }

    .toast-notification.error {
        background-color: #dc3545;
    }
  </style>
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2.43.4";

    const supabase = createClient("https://sfknzqkiqxivzcualcau.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNma256cWtpcXhpdnpjdWFsY2F1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3OTU0ODksImV4cCI6MjA3MjM3MTQ4OX0.JKjOS9NRdbVH1UanfqmBeHmMSnlWlZtDr-5LdKw5YaA");
    let products = [];

    // Searchable Dropdown Implementation
    function createSearchableDropdown(selectElement, options, placeholder = 'Select an option') {
      const container = document.createElement('div');
      container.className = 'searchable-dropdown';
      
      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'dropdown-input';
      input.placeholder = placeholder;
      input.readOnly = true;
      
      const dropdownList = document.createElement('div');
      dropdownList.className = 'dropdown-list';
      
      container.appendChild(input);
      container.appendChild(dropdownList);
      
      // Replace the original select element
      selectElement.style.display = 'none';
      selectElement.parentNode.insertBefore(container, selectElement);
      
      let filteredOptions = [...options];
      let allOptions = [...options];
      
      function renderOptions() {
        dropdownList.innerHTML = '';
        
        if (filteredOptions.length === 0) {
          const noResults = document.createElement('div');
          noResults.className = 'no-results';
          noResults.textContent = 'No results found';
          dropdownList.appendChild(noResults);
          return;
        }
        
        filteredOptions.forEach(option => {
          const item = document.createElement('div');
          item.className = 'dropdown-item';
          item.textContent = option.text;
          item.dataset.value = option.value;
          
          if (option.value === selectElement.value) {
            item.classList.add('selected');
          }
          
          item.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            selectElement.value = option.value;
            input.value = option.text;
            container.classList.remove('active');
            input.readOnly = true;
            
            // Remove selected and highlighted classes from all items
            dropdownList.querySelectorAll('.dropdown-item').forEach(el => {
              el.classList.remove('selected', 'highlighted');
            });
            item.classList.add('selected');
            
            // Trigger change event on original select
            const event = new Event('change', { bubbles: true });
            selectElement.dispatchEvent(event);
          });
          
          dropdownList.appendChild(item);
        });
      }
      
      function filterOptions(searchTerm) {
        const term = searchTerm.toLowerCase().trim();
        if (term === '') {
          filteredOptions = [...allOptions];
        } else {
          filteredOptions = allOptions.filter(option => 
            option.text.toLowerCase().includes(term)
          );
        }
        renderOptions();
      }
      
      // Set initial value if select has a value
      const initialSelectedOption = allOptions.find(opt => opt.value === selectElement.value);
      if (initialSelectedOption) {
        input.value = initialSelectedOption.text;
      } else if (allOptions.length > 0 && allOptions[0].value === '') {
        input.value = allOptions[0].text;
      }
      
      // Input events
      input.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        if (input.readOnly) {
          input.readOnly = false;
          input.value = '';
          container.classList.add('active');
          input.focus();
          filterOptions('');
        }
      });
      
      input.addEventListener('input', (e) => {
        if (!input.readOnly) {
          filterOptions(e.target.value);
        }
      });
      
      // Handle clicks outside to close dropdown
      document.addEventListener('click', (e) => {
        if (!container.contains(e.target)) {
          container.classList.remove('active');
          input.readOnly = true;
          
          // Reset input value to selected option or placeholder
          const selectedOption = allOptions.find(opt => opt.value === selectElement.value);
          if (selectedOption) {
            input.value = selectedOption.text;
          } else {
            input.value = allOptions[0]?.text || '';
          }
          
          // Remove highlighted items
          dropdownList.querySelectorAll('.dropdown-item').forEach(el => {
            el.classList.remove('highlighted');
          });
        }
      });
      
      // Add keyboard navigation
      input.addEventListener('keydown', (e) => {
        if (!container.classList.contains('active')) return;
        
        const items = dropdownList.querySelectorAll('.dropdown-item:not(.no-results)');
        const currentSelected = dropdownList.querySelector('.dropdown-item.highlighted');
        let currentIndex = currentSelected ? Array.from(items).indexOf(currentSelected) : -1;
        
        switch(e.key) {
          case 'ArrowDown':
            e.preventDefault();
            if (currentSelected) currentSelected.classList.remove('highlighted');
            currentIndex = (currentIndex + 1) % items.length;
            if (items[currentIndex]) items[currentIndex].classList.add('highlighted');
            break;
          case 'ArrowUp':
            e.preventDefault();
            if (currentSelected) currentSelected.classList.remove('highlighted');
            currentIndex = currentIndex <= 0 ? items.length - 1 : currentIndex - 1;
            if (items[currentIndex]) items[currentIndex].classList.add('highlighted');
            break;
          case 'Enter':
            e.preventDefault();
            if (currentSelected) {
              currentSelected.click();
            }
            break;
          case 'Escape':
            e.preventDefault();
            container.classList.remove('active');
            input.readOnly = true;
            const selectedOption = allOptions.find(opt => opt.value === selectElement.value);
            if (selectedOption) {
              input.value = selectedOption.text;
            } else {
              input.value = allOptions[0]?.text || '';
            }
            break;
        }
      });
      
      // Initialize
      renderOptions();
      
      return {
        updateOptions: (newOptions) => {
          allOptions = [...newOptions];
          filteredOptions = [...newOptions];
          renderOptions();
          
          // Update input value if needed
          const selectedOption = allOptions.find(opt => opt.value === selectElement.value);
          if (selectedOption) {
            input.value = selectedOption.text;
          } else if (allOptions.length > 0) {
            input.value = allOptions[0].text;
          }
        },
        container,
        selectElement
      };
    }

    function showToast(message, isSuccess = true) {
        const toast = document.getElementById('toast-message');
        toast.className = 'toast-notification'; // Reset classes
        if (isSuccess) {
            toast.classList.add('success');
            toast.innerHTML = `<i class="fas fa-check-circle icon"></i> ${message}`;
        } else {
            toast.classList.add('error');
            toast.innerHTML = `<i class="fas fa-exclamation-circle icon"></i> ${message}`;
        }
        
        toast.classList.add('show');

        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    function showMessage(id, message, isError = false) {
        const element = document.getElementById(id);
        element.textContent = message;
        element.className = 'message ' + (isError ? 'error-message' : 'success-message');
        element.style.display = 'block';
    }

    async function loadForecasts(filters = {}) {
      let query = supabase
        .from('v_forecast_with_order_status')
        .select(`*, product_variety ( product_name, variety_name )`)
        .order('date_of_sowing', { ascending: true });

      if (filters.product_variety_id) {
        // Filter by the actual product_variety_id field
        query = query.eq('product_variety_id', filters.product_variety_id);
      }

      if (filters.year) {
        query = query.eq('year', filters.year);
      }

      if (filters.import_month) {
        const year = filters.import_month.split('-')[0];
        const month = filters.import_month.split('-')[1];
        query = query.gte('date_of_sowing', `${year}-${month}-01`).lte('date_of_sowing', `${year}-${month}-31`);
      }

      if (filters.enlistment_status != null && filters.enlistment_status !== '') {
        query = query.eq('enlistment_status', filters.enlistment_status);
      }

      if (filters.order_status != null && filters.order_status !== '') {
        query = query.eq('order_status', filters.order_status);
      }

      const { data, error } = await query;

      if (error) {
        console.error('Query error:', error);
        document.getElementById("forecasts-list").innerHTML = `<p class="error-message">Error loading forecasts: ${error.message}</p>`;
        return;
      }

      const tableBody = document.getElementById("forecasts-table-body");
      let html = "";
      data.forEach(item => {
        const productName = item.product_variety ? `${item.product_variety.product_name} - ${item.product_variety.variety_name}` : 'N/A';
        const alertSentClass = item.dos_alert_sent ? 'alert-sent' : '';
        html += `<tr>
          <td class="${alertSentClass}">${productName}</td>
          <td class="${alertSentClass}">${item.year}</td>
          <td class="${alertSentClass}">${item.forecast_qty}</td>
          <td class="${alertSentClass}">${new Date(item.date_of_sowing).toLocaleString('default', { month: 'long' })}</td>
          <td class="${alertSentClass}" title="${item.dos_alert_sent ? 'Alert Sent' : 'Alert Not Sent'}">${item.dos_alert_sent ? '<i class="fas fa-bell" style="color: green;"></i>' : '<i class="fas fa-bell-slash" style="color: red;"></i>'}</td>
          <td class="${alertSentClass}" title="${item.enlistment_status ? 'Enlisted' : 'Not Enlisted'}">${item.enlistment_status ? '<i class="fas fa-check-circle" style="color: green;"></i>' : '<i class="fas fa-times-circle" style="color: red;"></i>'}</td>
          <td class="${alertSentClass}" title="${item.order_status ? 'Ordered' : 'Not Ordered'}">${item.order_status ? '<i class="fas fa-check-circle" style="color: green;"></i>' : '<i class="fas fa-times-circle" style="color: red;"></i>'}</td>
          <td class="action-cell">
            <button class="button-secondary" onclick='openForecastModal(${JSON.stringify(item)})'>Edit</button>
            <button class="button-secondary" onclick='deleteForecast("${item.id}")'>Delete</button>
          </td>
        </tr>`;
      });
      tableBody.innerHTML = html;
    }

    async function deleteForecast(id) {
      if (!confirm('Are you sure you want to delete this forecast?')) {
        return;
      }

      const { error } = await supabase.from('forecast').delete().eq('id', id);

      if (error) {
        showMessage('modal-message', `Error deleting forecast: ${error.message}`, true);
      } else {
        loadForecasts();
      }
    }

    async function openForecastModal(forecast = null) {
      showMessage('modal-message', '');
      const form = document.getElementById('forecast-form');
      form.reset();
      document.getElementById('forecast-id').value = forecast ? forecast.id : '';

      const productSelect = document.getElementById('product_variety_id');
      
      // Remove existing searchable dropdown if it exists
      const existingDropdown = productSelect.previousElementSibling;
      if (existingDropdown && existingDropdown.classList.contains('searchable-dropdown')) {
        existingDropdown.remove();
        productSelect.style.display = '';
      }
      
      productSelect.innerHTML = '<option value="">Select a Product</option>';
      
      const productOptions = [
        { value: '', text: 'Select a Product' },
        ...products.map(p => ({
          value: p.id,
          text: `${p.product_name} - ${p.variety_name}`
        }))
      ];
      
      // Add options to original select
      products.forEach(p => {
        const option = document.createElement('option');
        option.value = p.id;
        option.textContent = `${p.product_name} - ${p.variety_name}`;
        productSelect.appendChild(option);
      });
      
      // Create searchable dropdown
      const productDropdown = createSearchableDropdown(
        productSelect,
        productOptions,
        'Search products...'
      );

      if (forecast) {
        document.getElementById('modal-title').textContent = 'Edit Forecast';
        productSelect.value = forecast.product_variety_id;
        document.getElementById('year').value = forecast.year;
        document.getElementById('forecast_qty').value = forecast.forecast_qty;
        document.getElementById('date_of_sowing').value = forecast.date_of_sowing;
        
        // Update the searchable dropdown input display
        const selectedProduct = productOptions.find(opt => opt.value === forecast.product_variety_id);
        if (selectedProduct && productDropdown.container) {
          const productInput = productDropdown.container.querySelector('.dropdown-input');
          if (productInput) productInput.value = selectedProduct.text;
        }
      } else {
        document.getElementById('modal-title').textContent = 'Create New Forecast';
      }

      document.getElementById('forecast-modal').style.display = 'flex';
    }

    async function saveForecast() {
      const id = document.getElementById('forecast-id').value;
      const forecastData = {
        product_variety_id: document.getElementById('product_variety_id').value,
        year: document.getElementById('year').value,
        forecast_qty: document.getElementById('forecast_qty').value,
        date_of_sowing: document.getElementById('date_of_sowing').value,
      };

      let query;
      if (id) {
        query = supabase.from('forecast').update(forecastData).eq('id', id);
      } else {
        query = supabase.from('forecast').insert(forecastData);
      }

      const { error } = await query;
      if (error) {
        showMessage('modal-message', `Error saving forecast: ${error.message}`, true);
      } else {
        closeModal();
        loadForecasts();
      }
    }

    function closeModal() {
      document.getElementById('forecast-modal').style.display = 'none';
    }

    window.openForecastModal = openForecastModal;
    window.saveForecast = saveForecast;
    window.closeModal = closeModal;
    window.deleteForecast = deleteForecast;

    async function refreshEnlistmentStatus() {
      const { error } = await supabase.rpc('refresh_enlistment_status');

      if (error) {
        showToast(`Error: ${error.message}`, false);
      } else {
        showToast('Enlistment status refreshed successfully!');
        await loadForecasts();
      }
    }

    window.refreshEnlistmentStatus = refreshEnlistmentStatus;

    async function initializeProductFilter() {
      const productFilter = document.getElementById('product-name-filter');
      
      // Remove existing searchable dropdown if it exists
      const existingDropdown = productFilter.previousElementSibling;
      if (existingDropdown && existingDropdown.classList.contains('searchable-dropdown')) {
        existingDropdown.remove();
        productFilter.style.display = '';
      }
      
      productFilter.innerHTML = '<option value="">All Products</option>';
      
      const productOptions = [
        { value: '', text: 'All Products' },
        ...products.map(p => ({
          value: p.id,
          text: `${p.product_name} - ${p.variety_name}`
        }))
      ];
      
      // Add options to original select
      products.forEach(p => {
        const option = document.createElement('option');
        option.value = p.id;
        option.textContent = `${p.product_name} - ${p.variety_name}`;
        productFilter.appendChild(option);
      });
      
      // Create searchable dropdown
      createSearchableDropdown(
        productFilter,
        productOptions,
        'Search products...'
      );
    }

    window.onload = async () => {
      const loader = document.getElementById("loader");
      loader.style.display = "block";

      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
          window.location.href = 'login.html';
          return;
      }

      const { data: productData, error: productError } = await supabase.from('product_variety').select('*');
      if (productError) {
        console.error("Failed to load products for form");
      } else {
        products = productData;
        // Initialize the product filter dropdown
        await initializeProductFilter();
      }

      document.getElementById('filter-toggle-btn').addEventListener('click', () => {
        const filterPane = document.getElementById('filter-pane');
        const toggleBtn = document.getElementById('filter-toggle-btn');
        
        if (filterPane.classList.contains('open')) {
          filterPane.classList.remove('open');
          toggleBtn.classList.remove('active');
        } else {
          filterPane.classList.add('open');
          toggleBtn.classList.add('active');
        }
      });



      document.getElementById('apply-filters-btn').addEventListener('click', () => {

        const filters = {

            product_variety_id: document.getElementById('product-name-filter').value || null,

            year: document.getElementById('year-filter').value || null,

            import_month: document.getElementById('import-month-filter').value || null,

            enlistment_status: document.getElementById('enlistment-status-filter').value,

            order_status: document.getElementById('order-status-filter').value

        };

        loadForecasts(filters);

        updateFilterBadge();

      });



      document.getElementById('clear-filters-btn').addEventListener('click', () => {

        document.getElementById('product-name-filter').value = '';

        document.getElementById('year-filter').value = '';

        document.getElementById('import-month-filter').value = '';

        document.getElementById('enlistment-status-filter').value = '';

        document.getElementById('order-status-filter').value = '';

        // Clear searchable dropdown input for product filter
        const productDropdownInput = document.querySelector('#product-name-filter').previousElementSibling?.querySelector('.dropdown-input');
        if (productDropdownInput) {
          productDropdownInput.value = 'All Products';
          productDropdownInput.readOnly = true;
        }

        loadForecasts();

        updateFilterBadge();

      });



      function updateFilterBadge() {

        const filters = {

            product_variety_id: document.getElementById('product-name-filter').value,

            year: document.getElementById('year-filter').value,

            import_month: document.getElementById('import-month-filter').value,

            enlistment_status: document.getElementById('enlistment-status-filter').value,

            order_status: document.getElementById('order-status-filter').value

        };

        let activeFilters = 0;

        if (filters.product_variety_id) activeFilters++;

        if (filters.year) activeFilters++;

        if (filters.import_month) activeFilters++;

        if (filters.enlistment_status !== '' && filters.enlistment_status !== null) activeFilters++;

        if (filters.order_status !== '' && filters.order_status !== null) activeFilters++;



        const badge = document.getElementById('filter-count-badge');

        if (activeFilters > 0) {

          badge.textContent = activeFilters;

          badge.style.display = 'inline';

        } else {

          badge.style.display = 'none';

        }

      }



      await loadForecasts();      loader.style.display = "none";
    };
  </script>
</head>
<body>
  <div class="loader-overlay" id="loader">
    <div class="loader">
      <div class="loader-dot"></div>
      <div class="loader-dot"></div>
      <div class="loader-dot"></div>
    </div>
  </div>
  <aside class="sidebar">
     <div class="sidebar-header">
      <img src="https://i.postimg.cc/j5K3DCyc/20250826-1802-Imports-360-Logo-simple-compose-01k3k7grx1f2fsmtvdcvwbx54s.png" alt="Logo" class="sidebar-logo">
      <button class="sidebar-toggle">
        <i class="fas fa-bars"></i>
      </button>
    </div>
    <nav class="sidebar-nav">
      <ul>
        <li>
          <a href="admin-dashboard.html" class="nav-link">
            <i class="fas fa-home icon"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>
        <li>
          <a href="documents.html" class="nav-link">
            <i class="fas fa-file-alt icon"></i>
            <span class="text">Documents</span>
          </a>
        </li>
        <li>
          <a href="forecast.html" class="nav-link active">
            <i class="fas fa-bullhorn icon"></i>
            <span class="text">Forecasts</span>
          </a>
        </li>
        <li><a href="verification-list.html" class="nav-link"><i class="fas fa-check-double icon"></i><span class="text">Verification List</span></a></li>
        <li>
          <a href="#" class="nav-link has-submenu">
            <i class="fas fa-box icon"></i>
            <span class="text">Shipments</span>
            <span class="arrow"><i class="fas fa-chevron-down"></i></span>
          </a>
          <ul class="submenu">
            <li><a href="shipment_tracker.html" class="nav-link"><span class="text">Shipment Tracker</span></a></li>
            <li><a href="shipment-details.html" class="nav-link"><span class="text">All Shipments</span></a></li>
          </ul>
        </li>
        <li>
          <a href="product-details.html" class="nav-link">
            <i class="fas fa-tags icon"></i>
            <span class="text">Products</span>
          </a>
        </li>
        <li>
          <a href="supplier-details.html" class="nav-link">
            <i class="fas fa-truck icon"></i>
            <span class="text">Suppliers</span>
          </a>
        </li>
        <li>
          <a href="supplier-shipment-responses.html" class="nav-link">
            <i class="fas fa-inbox icon"></i>
            <span class="text">Supplier Responses</span>
          </a>
        </li>
        <li>
          <a href="bank-details.html" class="nav-link">
            <i class="fas fa-university icon"></i>
            <span class="text">Banks</span>
          </a>
        </li>
        <li>
          <a href="clearing-agent-details.html" class="nav-link">
            <i class="fas fa-user-shield icon"></i>
            <span class="text">Clearing Agents</span>
          </a>
        </li>
        <li>
          <a href="warehouse-details.html" class="nav-link">
            <i class="fas fa-warehouse icon"></i>
            <span class="text">Warehouses</span>
          </a>
        </li>
        <li><a href="logistic-cells.html" class="nav-link"><i class="fas fa-cubes icon"></i><span class="text">Logistic Cells</span></a></li>
        <li>
          <a href="#" class="nav-link has-submenu">
            <i class="fas fa-truck-ramp-box icon"></i>
            <span class="text">Freight</span>
            <span class="arrow"><i class="fas fa-chevron-down"></i></span>
          </a>
          <ul class="submenu open">
            <li><a href="send-freight-queries.html" class="nav-link"><span class="text">Send Freight Queries</span></a></li>
            <li><a href="freight-query-response.html" class="nav-link"><span class="text">Freight Query Response</span></a></li>
            <li><a href="manage-freight-queries.html" class="nav-link"><span class="text">Manage Freight Queries</span></a></li>
            <li><a href="award-shipment.html" class="nav-link"><span class="text">Award Shipment</span></a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </aside>

  <div class="main-content">
    <header class="main-header">
      <div class="header-title">
        <button class="back-button" onclick="window.history.back();"><i class="fas fa-arrow-left"></i></button>
        <h1>Forecasts</h1>
      </div>
      <div>
        <button id="filter-toggle-btn" class="button button-secondary">
          <i class="fas fa-filter"></i>
          <span>Filters</span>
          <span id="filter-count-badge" class="badge" style="display: none;"></span>
        </button>
        <button onclick="openForecastModal()">Create New Forecast</button>
        <button onclick="refreshEnlistmentStatus()" class="button-secondary ml-2">Refresh Enlistment Status</button>
      </div>
    </header>

    <div class="panel">
      <div id="filter-pane" class="filter-pane">
        <div class="filter-group">
          <label for="product-name-filter">Product Name</label>
          <select id="product-name-filter">
            <option value="">All Products</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="year-filter">Year</label>
          <input type="number" id="year-filter" placeholder="Enter year">
        </div>
        <div class="filter-group">
          <label for="import-month-filter">Import Month</label>
          <input type="month" id="import-month-filter">
        </div>
        <div class="filter-group">
          <label for="enlistment-status-filter">Enlistment Status</label>
          <select id="enlistment-status-filter">
            <option value="">All</option>
            <option value="true">Enlisted</option>
            <option value="false">Not Enlisted</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="order-status-filter">Order Status</label>
          <select id="order-status-filter">
            <option value="">All</option>
            <option value="true">Ordered</option>
            <option value="false">Not Ordered</option>
          </select>
        </div>
        <div class="button-container">
          <button id="apply-filters-btn" class="button">Apply</button>
          <button id="clear-filters-btn" class="button button-secondary">Clear</button>
        </div>
      </div>
      <div class="panel-body">
        <div id="forecasts-list" class="table-container">
          <table>
            <thead>
              <tr>
                <th>Product</th>
                <th>Year</th>
                <th>Forecast Qty</th>
                <th>Import Month</th>
                <th>Alert Sent?</th>
                <th>Enlistment Status</th>
                <th>Order Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="forecasts-table-body">
              <!-- Data will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <div id="forecast-modal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeModal()">&times;</span>
      <h2 id="modal-title">Create New Forecast</h2>
      <div id="modal-message"></div>
      <form id="forecast-form" onsubmit="event.preventDefault(); saveForecast();">
        <input type="hidden" id="forecast-id">
        <div>
          <label for="product_variety_id">Product</label>
          <select id="product_variety_id" required></select>
        </div>
        <div>
          <label for="year">Year</label>
          <input type="number" id="year" placeholder="e.g., 2025" required>
        </div>
        <div>
          <label for="forecast_qty">Forecast Quantity</label>
          <input type="number" id="forecast_qty" required>
        </div>
        <div>
          <label for="date_of_sowing">Import Month</label>
          <input type="date" id="date_of_sowing" required>
        </div>
        <div class="button-container">
          <button type="submit">Save</button>
        </div>
      </form>
    </div>
  </div>

<script>
    // Standard sidebar and responsive logic
    document.addEventListener('DOMContentLoaded', () => {
      const sidebar = document.querySelector('.sidebar');
      const sidebarToggle = document.querySelector('.sidebar-toggle');
      const navLinks = document.querySelectorAll('.nav-link');
      const hasSubmenus = document.querySelectorAll('.has-submenu');
      const mediaQuery = window.matchMedia('(max-width: 768px)');

      function handleMediaQueryChange(e) {
        if (e.matches) {
          sidebar.classList.remove('collapsed');
          sidebar.classList.remove('open');
        } else {
          sidebar.classList.remove('open');
        }
      }

      handleMediaQueryChange(mediaQuery);
      mediaQuery.addListener(handleMediaQueryChange);

      sidebarToggle.addEventListener('click', () => {
        if (mediaQuery.matches) {
          sidebar.classList.toggle('open');
        } else {
          sidebar.classList.toggle('collapsed');
        }
      });

      hasSubmenus.forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault();
          const submenu = item.nextElementSibling;
          if (submenu && submenu.classList.contains('submenu')) {
            submenu.classList.toggle('open');
            item.classList.toggle('open');
          }
        });
      });

      const currentPath = window.location.pathname.split('/').pop();
      navLinks.forEach(link => {
        if (link.href.split('/').pop() === currentPath) {
          link.classList.add('active');
          let parentSubmenu = link.closest('.submenu');
          if (parentSubmenu) {
            parentSubmenu.classList.add('open');
            let parentHasSubmenu = parentSubmenu.previousElementSibling;
            if (parentHasSubmenu && parentHasSubmenu.classList.contains('has-submenu')) {
              parentHasSubmenu.classList.add('open');
            }
          }
        }
      });
    });
</script>
  <div id="toast-message"></div>
</body>
</html>